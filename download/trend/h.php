<?php//полное кодичество скачиваний за последний месяц  include_once "chart.api.php";include $_SERVER['DOCUMENT_ROOT']."/engine/data/dbconfig.php";function get_data($where){    $db1=mysql_connect(DBHOST2, DBUSER2,DBPASS2) or    die("Could not connect: " . mysql_error());    mysql_select_db(DBNAME2,$db1);    mysql_query("SET NAMES ".COLLATE2,$db1);    $sql="SELECT DATE_FORMAT( created,  '%Y-%m-%d_%H' ) as created, COUNT( catalog_group_id ) AS  `count` FROM  `fl_catalog_clicks` WHERE  `created` > DATE_SUB( CURDATE( ) , INTERVAL 1 WEEK ) {$where}GROUP BY DATE_FORMAT( created,  '%Y-%m-%d_%H' ) order by created";//echo $sql."<br>";    $result=mysql_query($sql,$db1);    $rows=array();$ids=array();    while($row=mysql_fetch_assoc($result))    {        $serie[$row['created']]=$row['count'];    }    mysql_close();    return $serie;}        echo "<table border=1>";   $cache = new Chart("h","","graph for hours fo all");   $datas=$cache->data;   if(empty($datas)) $datas=array("and 1"=>  array(),"AND catalog_sgroup_id =1"=>array(),"AND catalog_sgroup_id =2"=>array());   $cache->yspace=24;   $series=array();   foreach ($datas as $k=>$data)   {       $where='';   if(!empty($data))       {       end($data);       $date=key($data); $where=" and DATE_FORMAT( created,  '%Y-%m-%d_%H' )>='".$date."'";       }        $where=$k.$where;       $serie=get_data($where);    if(is_array($data))$serie= array_merge($data,$serie);    $series[$k]=$serie;   }$cache->setData($series);$cache->deleteFromArray(date("Y-m-d_h", mktime(0, 0, 0, date("m"),date("d"),date("Y"))-7*60*60*24));$cache->set();$img=$cache->getImg();if($img)echo "<br><a href='".$img."'><img src='".$img."'></a>";?>